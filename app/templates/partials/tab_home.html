<div>
  <h2>Inicio</h2>
  <p class="muted">Resumen general (lo iremos ampliando paso a paso).</p>

  <div class="grid" style="grid-template-columns: 1fr 1fr 1fr;">
    <div class="card">
      <div class="muted">Productos</div>
      <div style="font-size:22px;font-weight:700;">{{ totals.products }}</div>
    </div>
    <div class="card">
      <div class="muted">Stock total</div>
      <div style="font-size:22px;font-weight:700;">{{ '%.0f'|format(totals.stock_total or 0) }}</div>
    </div>
    <div class="card">
      <div class="muted">Por reponer</div>
      <div style="font-size:22px;font-weight:700;">{{ totals.to_restock }}</div>
    </div>
  </div>

  <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top:12px;">
    <div class="card">
      <div class="muted">Más vendido (mes)</div>
      <div style="font-size:18px;font-weight:700;">{{ (top_seller.name if top_seller else '-') }}</div>
      <div class="muted">{{ (top_seller.sku if top_seller else '') }} {% if top_seller %}- {{ '%.0f'|format(top_seller.qty or 0) }} u.{% endif %}</div>
    </div>
    <div class="card">
      <div class="muted">Mayor margen % (mes)</div>
      <div style="font-size:18px;font-weight:700;">{{ (top_margin.name if top_margin else '-') }}</div>
      <div class="muted">{{ (top_margin.sku if top_margin else '') }} {% if top_margin %}- {{ '%.2f'|format(top_margin.gross_pct or 0) }}%{% endif %}</div>
    </div>
  </div>

  <div class="card" style="margin-top:16px;" id="restock"
       hx-get="/ui/restock-table" hx-trigger="load, every 5s" hx-swap="innerHTML">
  </div>

  <div class="card" style="margin-top:16px;">
    <h3>Resumen mensual</h3>
    <p class="muted">Ventas, compras y utilidad bruta por mes (últimos 12 meses).</p>
    <canvas id="monthly-chart" height="120"></canvas>
    <script type="application/json" id="monthly-chart-data">{{ monthly_chart_json | safe }}</script>
    <div id="monthly-chart-debug" class="muted" style="margin-top:8px;"></div>
  </div>

  <script>
    if(window.renderMonthlyChart){ window.renderMonthlyChart(document); }
  </script>
</div>
