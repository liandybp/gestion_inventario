<table>
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Img</th>
      <th>SKU</th>
      <th>Nombre</th>
      <th>Unidad</th>
      <th>Cant.</th>
      <th>Costo</th>
      <th>Lote</th>
      <th>Barcode</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for id, d, sku, name, uom, image_url, qty, unit_cost, lot_code in purchases %}
      <tr>
        <td>{{ d.strftime('%Y-%m-%d %H:%M') if d else '' }}</td>
        <td>
          {% if image_url %}
            <img src="{{ image_url }}" alt="" style="width:36px;height:36px;object-fit:cover;border-radius:8px;border:1px solid #e5e7eb;" />
          {% endif %}
        </td>
        <td>{{ sku }}</td>
        <td>{{ name }}</td>
        <td>{{ uom or '' }}</td>
        <td>{{ '%.0f'|format(qty or 0) }}</td>
        <td>{{ '%.2f'|format(unit_cost or 0) }}</td>
        {% set lot_disp = (lot_code[:-5] if lot_code and lot_code.endswith('00000') else lot_code) %}
        <td>{{ lot_disp or '' }}</td>
        <td>
          {% if lot_disp %}
            <svg class="barcode" data-code="{{ lot_disp }}"></svg>
          {% endif %}
        </td>
        <td>
          <button type="button"
                  hx-get="/ui/movement/purchase/{{ id }}/edit"
                  hx-target="#purchase-edit"
                  hx-swap="innerHTML">Edit</button>

          <button type="button" style="margin-left:8px;background: var(--brand-red);"
                  hx-post="/ui/movement/purchase/{{ id }}/delete"
                  hx-target="#purchase-panel"
                  hx-swap="outerHTML"
                  hx-confirm="Â¿Eliminar esta compra?">Del</button>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
