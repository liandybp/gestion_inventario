<div class="modal-overlay" id="user-edit-modal">
  <div class="modal-container">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Editar Usuario: {{ user.username }}</h3>
        <button type="button" class="modal-close" data-modal-close="user-edit-modal">&times;</button>
      </div>

      {% if message %}
      <div class="message {{ message_class }}">
        <strong>{{ message }}</strong>
        {% if message_detail %}<div class="muted">{{ message_detail }}</div>{% endif %}
      </div>
      {% endif %}

      <form hx-post="/ui/user/{{ user.id }}/update" hx-target="#tab-content" hx-swap="innerHTML">
        <div class="row"><label for="edit-username">Usuario *</label><input type="text" id="edit-username" name="username" value="{{ user.username }}" required autocomplete="off" /></div>

        <div class="row">
          <label for="edit-role">Rol *</label>
          <select id="edit-role" name="role" required>
            <option value="operator" {% if (user.role or '')|lower == 'operator' %}selected{% endif %}>Operador</option>
            <option value="owner" {% if (user.role or '')|lower == 'owner' %}selected{% endif %}>Due√±o</option>
            <option value="admin" {% if (user.role or '')|lower == 'admin' %}selected{% endif %}>Administrador</option>
          </select>
        </div>

        <div class="row">
          <label for="edit-business">Negocio</label>
          <select id="edit-business" name="business_id">
            <option value="">-- Sin negocio asignado --</option>
            {% for b in businesses %}
            <option value="{{ b.id }}" {% if user.business_id and user.business_id == b.id %}selected{% endif %}>{{ b.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="row">
          <label>
            <input type="checkbox" name="is_active" value="true" {% if user.is_active %}checked{% endif %} />
            Usuario activo
          </label>
          <div></div>
        </div>

        <button type="submit">Guardar Cambios</button>
        <button type="button" class="btn-secondary ml-8" data-modal-close="user-edit-modal">Cancelar</button>
      </form>
    </div>
  </div>
</div>
