<table>
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Img</th>
      <th>SKU</th>
      <th>Nombre</th>
      <th>Unidad</th>
      <th>Cant.</th>
      <th>Precio</th>
      <th>Lote</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for id, d, sku, name, uom, image_url, qty, unit_price, lot_codes in sales %}
      <tr>
        <td>{{ d.strftime('%Y-%m-%d %H:%M') if d else '' }}</td>
        <td>
          {% if image_url %}
            <img src="{{ image_url }}" alt="" style="width:36px;height:36px;object-fit:cover;border-radius:8px;border:1px solid #e5e7eb;" />
          {% endif %}
        </td>
        <td>{{ sku }}</td>
        <td>{{ name }}</td>
        <td>{{ uom or '' }}</td>
        <td>{{ '%.0f'|format(qty or 0) }}</td>
        <td>{{ '%.2f'|format(unit_price or 0) }}</td>
        <td>
          {% if lot_codes %}
            {% set lot_list = lot_codes.split(',') %}
            {% set lot_disp_list = [] %}
            {% for lc in lot_list %}
              {% set lc_trim = (lc[:-5] if lc.endswith('00000') else lc) %}
              {% set _ = lot_disp_list.append(lc_trim) %}
            {% endfor %}
            <span title="{{ lot_codes }}">{{ lot_disp_list|join(', ') }}</span>
          {% endif %}
        </td>
        <td>
          <button type="button"
                  hx-get="/ui/movement/sale/{{ id }}/edit"
                  hx-target="#sale-edit"
                  hx-swap="innerHTML">Edit</button>

          <button type="button" style="margin-left:8px;background: var(--brand-red);"
                  hx-post="/ui/movement/sale/{{ id }}/delete"
                  hx-target="#sale-panel"
                  hx-swap="outerHTML"
                  hx-confirm="Â¿Eliminar esta venta?">Del</button>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
