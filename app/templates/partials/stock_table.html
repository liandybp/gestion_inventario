{% from 'components/ui.html' import flash %}
{{ flash(message, message_class or '', message_detail) }}

<div class="table-wrapper">
<table>
  <thead>
    <tr>
      <th>SKU</th>
      <th>Nombre</th>
      <th>Unidad</th>
      <th>Stock</th>
      <th>Mínimo</th>
      <th>Aprov. (d)</th>
      <th>Reaprov. (d)</th>
      <th>Reponer</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
      <tr class="{% if item.needs_restock %}warn{% endif %}">
        <td>{{ item.sku }}</td>
        <td>{{ item.name or '' }}</td>
        <td>{{ item.unit_of_measure or '' }}</td>
        <td>{{ '%.0f'|format(item.quantity or 0) }}</td>
        <td>{{ '%.0f'|format(item.min_stock or 0) }}</td>
        <td>{{ item.lead_time_days or 0 }}</td>
        <td>{% if item.reorder_in_days is not none %}{{ item.reorder_in_days }}{% else %}-{% endif %}</td>
        <td>{% if item.needs_restock %}sí{% else %}no{% endif %}</td>
        <td>
          <button type="button"
                  hx-get="/ui/product/{{ item.sku }}/edit-inventory"
                  hx-target="#inventory-edit"
                  hx-swap="innerHTML">Edit</button>

          {% if user and (user.role or '')|lower == 'admin' %}
          <button type="button" class="ml-8 btn-danger"
                  hx-post="/ui/stock/{{ item.sku }}/delete"
                  hx-target="#stock-table"
                  hx-swap="innerHTML"
                  hx-include="#inventory_query"
                  hx-confirm="¿Eliminar este artículo? (Solo se permite si no tiene movimientos/lotes)">Del</button>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
</div>
